<!doctype html>
<html lang="ja" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>シナリオ一覧 | MIRAHUB</title>
  <meta name="description" content="MIRAHUB所持シナリオ一覧。検索・絞り込み・詳細表示・トレーラー対応。" />

  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="./scenarios.css" />

  <!-- テーマのチラつき防止 -->
  <script>
  (function(){
    try{
      const t = localStorage.getItem("mirahub.theme");
      if(t === "light" || t === "dark") document.documentElement.setAttribute("data-theme", t);
    }catch(e){}
  })();
  </script>
</head>

<body>
<a class="skip-link" href="#main">本文へスキップ</a>

<header class="layout-header">
  <div class="layout-wrap layout-header-inner">
    <div class="brand">
      <span class="brand-dot" aria-hidden="true"></span>
      <a href="../">MIRAHUB</a>
      <span class="text-muted" aria-hidden="true">/</span>
      <span>Scenarios</span>
    </div>

    <nav class="nav" aria-label="ナビゲーション">
      <a class="nav-link" href="../">HUB</a>
      <a class="nav-link" href="../shinji/">しんじ卓</a>
      <button class="icon-btn" id="themeToggle" type="button" aria-label="テーマ切替">🌓</button>
    </nav>
  </div>
</header>

<main class="layout-wrap" id="main">

  <!-- Head -->
  <section class="page-head">
    <div class="page-head-left">
      <h1 class="page-title">シナリオ一覧</h1>
      <p class="page-sub text-muted">
        Google Sheets 同期 / R18正規化 / 詳細モーダル / トレーラー / 外部確認
      </p>
    </div>

    <div class="page-head-right">
      <div class="head-actions">
        <button class="btn btn-ghost" id="refreshBtn" type="button">↻ 更新</button>
        <button class="btn btn-ghost" id="resetFiltersBtn" type="button">✕ リセット</button>
        <span id="status" class="text-muted" style="align-self:center;">待機中</span>
      </div>
      <div id="metaRow" class="text-muted sc-metaRow" style="margin-top:10px;"></div>
    </div>
  </section>

  <!-- Controls -->
  <section class="panel controls" aria-label="検索と絞り込み">
    <div class="controls-top">
      <label class="control search">
        <span class="control-label">検索</span>
        <input id="searchInput" type="search" placeholder="タイトル / システム / 作者 / タグ / メモ…" autocomplete="off">
      </label>

      <label class="control">
        <span class="control-label">ソート</span>
        <select id="sortSelect">
          <option value="id_desc">ID（新しい順）</option>
          <option value="id_asc">ID（古い順）</option>
          <option value="name_asc">タイトル（A→Z）</option>
          <option value="name_desc">タイトル（Z→A）</option>
          <option value="updated_desc">更新（新しい順）</option>
          <option value="updated_asc">更新（古い順）</option>
        </select>
      </label>

      <div class="control toggles" role="group" aria-label="表示オプション">
        <label class="toggle">
          <input id="toggleCompact" type="checkbox">
          <span>コンパクト</span>
        </label>
        <label class="toggle">
          <input id="toggleShowTrailers" type="checkbox" checked>
          <span>トレーラー</span>
        </label>
      </div>
    </div>

    <div class="controls-grid">
      <label class="control">
        <span class="control-label">システム</span>
        <select id="filterSystem">
          <option value="">指定なし</option>
        </select>
      </label>

      <label class="control">
        <span class="control-label">形式</span>
        <select id="filterFormat">
          <option value="">指定なし</option>
        </select>
      </label>

      <label class="control">
        <span class="control-label">R18</span>
        <select id="filterR18">
          <option value="">指定なし</option>
          <option value="none">なし</option>
          <option value="any">あり（soft/mix/hard）</option>
          <option value="unknown">不明</option>
        </select>
      </label>

      <label class="control">
        <span class="control-label">ロスト率</span>
        <select id="filterLoss">
          <option value="">指定なし</option>
          <option value="0-10">0–10%</option>
          <option value="10-30">10–30%</option>
          <option value="30-50">30–50%</option>
          <option value="50-70">50–70%</option>
          <option value="70-100">70–100%</option>
          <option value="unknown">不明</option>
        </select>
      </label>

      <label class="control">
        <span class="control-label">所要時間</span>
        <select id="filterTimePreset">
          <option value="">指定なし</option>
          <option value="lt120">〜2時間</option>
          <option value="120_360">2〜6時間</option>
          <option value="360_720">6〜12時間</option>
          <option value="gt720">12時間以上</option>
          <option value="unknown">不明</option>
        </select>
      </label>

      <label class="control">
        <span class="control-label">人数</span>
        <select id="filterPlayersPreset">
          <option value="">指定なし</option>
          <option value="solo">ソロ</option>
          <option value="2_3">2〜3</option>
          <option value="4_5">4〜5</option>
          <option value="6_8">6〜8</option>
          <option value="gt8">9以上</option>
          <option value="unknown">不明</option>
        </select>
      </label>
    </div>

    <!-- Tags -->
    <div class="tags-area">
      <div class="tags-head">
        <div class="control-label">タグ</div>
        <div class="tag-actions">
          <button class="chip-btn" id="tagsClearBtn" type="button">クリア</button>
          <button class="chip-btn" id="tagsModeBtn" type="button">条件：OR</button>
        </div>
      </div>

      <div class="tags-input-row">
        <input id="tagsSearchInput" type="search" placeholder="タグを検索…" autocomplete="off">
      </div>

      <div class="chips" id="tagsChips" aria-label="タグ候補"></div>
      <div class="chips selected" id="tagsSelected" aria-label="選択中タグ"></div>
    </div>
  </section>

  <!-- View -->
  <section class="section-card">
    <div class="sc-view-row">
      <div class="sc-tabs">
        <button type="button" class="sc-tab is-active" data-view="cards">カード</button>
        <button type="button" class="sc-tab" data-view="table">表</button>
      </div>
      <div id="resultInfo" class="text-muted"></div>
    </div>
  </section>

  <!-- Results -->
  <section class="section-card">
    <div id="scenarioGrid" class="sc-cards"></div>

    <div id="tableWrap" style="display:none;">
      <div class="sc-tableWrap">
        <table class="sc-table">
          <thead>
            <tr>
              <th>ID</th><th>名前</th><th>System</th><th>人数</th><th>形式</th><th>時間</th><th>R18</th><th>ロスト</th><th>URL</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </section>

</main>

<footer class="layout-footer">© MIRAHUB</footer>

<!-- Detail Modal -->
<div class="modal" id="detailModal" aria-hidden="true">
  <div class="modal-backdrop" data-close></div>

  <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="detailTitle">
    <div class="modal-top">
      <div class="modal-titleWrap">
        <div id="detailTitle" class="modal-title">詳細</div>
        <div id="detailSub" class="modal-sub text-muted"></div>
      </div>
      <button class="modal-close" data-close type="button" aria-label="閉じる">✕</button>
    </div>

    <div id="detailBody"></div>
  </div>
</div>

<!-- Zoom Modal -->
<div class="modal" id="zoomModal" aria-hidden="true">
  <div class="modal-backdrop" data-close></div>
  <div class="modal-panel modal-zoom" role="dialog" aria-modal="true" aria-label="画像拡大">
    <button class="modal-close" data-close type="button" aria-label="閉じる">✕</button>
    <img id="zoomImage" alt="">
  </div>
</div>

<!-- Confirm Modal -->
<div class="confirm" id="confirmModal" aria-hidden="true">
  <div class="confirm__backdrop" data-close></div>
  <div class="confirm__panel" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <div class="confirm__title" id="confirmTitle">確認</div>
    <div class="confirm__text" id="confirmMessage"></div>

    <label class="confirm__check">
      <input type="checkbox" id="confirmDontAsk">
      今後（通常リンクは）確認しない
    </label>

    <div class="confirm__actions">
      <button class="btn btn-ghost" id="confirmCancel" type="button">キャンセル</button>
      <button class="btn btn-primary" id="confirmOk" type="button">移動する</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toastHost" class="toast-host" aria-live="polite"></div>

<script src="./scenarios.js"></script>
</body>
</html>