<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Q&A | しんじ卓</title>

  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="./shinji.css">
</head>

<body>

<header class="layout-header">
  <div class="layout-wrap layout-header-inner">

    <div class="brand">
      <span class="brand-dot"></span>
      <a href="../">MIRAHUB</a>
      <span class="text-muted">/</span>
      <a href="./">しんじ卓</a>
      <span class="text-muted">/</span>
      <span>Q&A</span>
    </div>

    <nav>
      <a class="nav-link" href="./">トップ</a>
      <a class="nav-link" href="./rules.html">ルール</a>
      <a class="nav-link nav-link-active" href="./qa.html">Q&A</a>
    </nav>

  </div>
</header>

<main class="layout-wrap qa-layout" id="top">

  <!-- 左：本文 -->
  <div class="qa-main">

    <section class="section-hero">
      <p class="text-tag">Q&A</p>
      <h1 class="text-hero">よくある質問</h1>
      <p class="text-lead text-muted">
        困ったらまずここ。検索とフィルタで一発で探せます。<br>
        （ブラウザ検索 Ctrl + F も併用OK）
      </p>

      <div class="btn-row">
        <a class="btn btn-ghost" href="./rules.html">ルールへ</a>
        <a class="btn btn-ghost" href="./">しんじ卓トップへ</a>
      </div>
    </section>

    <!-- 検索・フィルタ -->
    <section class="section-card" id="qaControls">
      <h2>検索・フィルタ</h2>

      <div class="qa-controls">
        <div class="qa-search">
          <div class="qa-search__label">SEARCH</div>
          <input id="qaSearch" class="qa-search__input" type="search"
                 placeholder="例：遅刻 / 欠席 / 録画 / 7版 / ココフォリア など">
        </div>

        <div class="qa-filters" id="qaFilters">
          <button class="qa-filter is-active" type="button" data-filter="all">全部</button>
          <button class="qa-filter" type="button" data-filter="join">参加・初心者</button>
          <button class="qa-filter" type="button" data-filter="session">卓・セッション</button>
          <button class="qa-filter" type="button" data-filter="tools">ツール</button>
          <button class="qa-filter" type="button" data-filter="rules">ルール</button>
          <button class="qa-filter" type="button" data-filter="trouble">トラブル</button>
          <button class="qa-filter" type="button" data-filter="other">その他</button>
        </div>

        <div class="qa-utils">
          <button class="btn btn-ghost btn-mini" type="button" id="qaOpenAll">全部開く</button>
          <button class="btn btn-ghost btn-mini" type="button" id="qaCloseAll">全部閉じる</button>
          <button class="btn btn-ghost btn-mini" type="button" id="qaClear">検索クリア</button>
        </div>

        <p class="text-muted qa-hint" id="qaHit"></p>
      </div>
    </section>

    <!-- 参加・初心者 -->
    <section class="section-card qa-section" id="join" data-cat="join">
      <h2>参加・初心者</h2>

      <details class="qa-item">
        <summary>Q. 初心者でも参加していい？</summary>
        <p>A. OK。分からないところはKPや周りがサポートします。</p>
      </details>

      <details class="qa-item">
        <summary>Q. 参加の流れは？</summary>
        <p>A. 募集を見る → 参加宣言 → キャラ提出 → 当日集合、の流れです。</p>
      </details>
    </section>

    <!-- 卓・セッション -->
    <section class="section-card qa-section" id="session" data-cat="session">
      <h2>卓・セッション</h2>

      <details class="qa-item">
        <summary>Q. 遅刻しそう / 欠席になりそう</summary>
        <p>A. 分かった時点で連絡してください。目安は<a class="link" href="./rules.html#t1">卓ルール（無断遅刻・無断欠席）</a>を確認。</p>
      </details>

      <details class="qa-item">
        <summary>Q. 観戦や録画、配信はしていい？</summary>
        <p>A. 参加者全員の許可が必須です。詳細は<a class="link" href="./rules.html#t4">卓ルール（観戦・録画・配信）</a>へ。</p>
      </details>
    </section>

    <!-- ツール -->
    <section class="section-card qa-section" id="tools" data-cat="tools">
      <h2>ツール</h2>

      <details class="qa-item">
        <summary>Q. 使用ツールは？</summary>
        <p>A. Discord（連絡/通話）、ココフォリア（盤面）、いあきゃら等（キャラ管理）を使います。</p>
      </details>
    </section>

    <!-- ルール -->
    <section class="section-card qa-section" id="rules" data-cat="rules">
      <h2>ルール</h2>

      <details class="qa-item">
        <summary>Q. 7版のルールや技能は使える？</summary>
        <p>A. 基本は6版準拠です。7版持ち込みは不可で、コンバートはKP判断です（<a class="link" href="./rules.html#h1">ハウスルール</a>）。</p>
      </details>

      <details class="qa-item">
        <summary>Q. 技能上限はいくつ？</summary>
        <p>A. 90です（<a class="link" href="./rules.html#h2">ハウスルール（キャラ作成）</a>）。</p>
      </details>
    </section>

    <!-- トラブル -->
    <section class="section-card qa-section" id="trouble" data-cat="trouble">
      <h2>トラブル</h2>

      <details class="qa-item">
        <summary>Q. 困ったときはどこに相談すればいい？</summary>
        <p>A. まずは運営（管理人ロール）へ相談してください。金銭・個人情報のトラブルは対応不可です（<a class="link" href="./rules.html#r3">サーバールール</a>）。</p>
      </details>
    </section>

    <!-- その他 -->
    <section class="section-card qa-section" id="other" data-cat="other">
      <h2>その他</h2>

      <details class="qa-item">
        <summary>Q. ネタバレの扱いは？</summary>
        <p>A. 未通過/通過中の人がいる可能性があるので注意してください（<a class="link" href="./rules.html#t5">卓ルール</a>）。</p>
      </details>
    </section>

    <section class="section-card">
      <div class="btn-row">
        <a class="btn btn-ghost" href="#top" onclick="window.scrollTo({top:0, behavior:'smooth'}); return false;">上に戻る</a>
        <a class="btn btn-ghost" href="./">しんじ卓トップへ</a>
      </div>
    </section>

  </div>

  <!-- 右：固定目次（PCのみ） -->
  <aside class="qa-aside" id="qaToc">
    <section class="section-card">
      <h2>カテゴリ</h2>
      <div class="toc toc-3">
        <a class="toc-item" href="#qaControls">検索</a>
        <a class="toc-item" href="#join">参加</a>
        <a class="toc-item" href="#session">卓</a>
        <a class="toc-item" href="#tools">ツール</a>
        <a class="toc-item" href="#rules">ルール</a>
        <a class="toc-item" href="#trouble">トラブル</a>
        <a class="toc-item" href="#other">その他</a>
      </div>

      <hr class="hr">
      <div class="btn-row" style="margin-top:10px;">
        <a class="btn btn-ghost" href="#top" onclick="window.scrollTo({top:0, behavior:'smooth'}); return false;">上へ</a>
        <a class="btn btn-ghost" href="./">トップ</a>
      </div>
    </section>
  </aside>

</main>

<footer class="layout-footer">
  © MIRAHUB / しんじ卓
</footer>

<script>
(() => {
  const search = document.getElementById("qaSearch");
  const hit = document.getElementById("qaHit");
  const filters = document.getElementById("qaFilters");
  const btnOpenAll = document.getElementById("qaOpenAll");
  const btnCloseAll = document.getElementById("qaCloseAll");
  const btnClear = document.getElementById("qaClear");

  const sections = Array.from(document.querySelectorAll(".qa-section"));
  const items = Array.from(document.querySelectorAll(".qa-item"));

  let activeCat = "all";

  const normalize = (s) => (s || "").toLowerCase().replace(/\s+/g, " ").trim();

  const apply = () => {
    const q = normalize(search.value);
    let visibleItems = 0;

    // まず全アイテムの表示判定
    items.forEach(d => {
      const sec = d.closest(".qa-section");
      const cat = sec?.dataset?.cat || "";
      const inCat = (activeCat === "all") || (cat === activeCat);

      const text = normalize(d.innerText);
      const inQuery = !q || text.includes(q);

      const show = inCat && inQuery;
      d.style.display = show ? "" : "none";
      if (show) visibleItems++;
    });

    // セクション自体の表示（中が空なら隠す）
    sections.forEach(sec => {
      const anyVisible = Array.from(sec.querySelectorAll(".qa-item"))
        .some(d => d.style.display !== "none");
      sec.style.display = anyVisible ? "" : "none";
    });

    // ヒット表示
    if (!q && activeCat === "all") {
      hit.textContent = "検索なし：全カテゴリを表示中";
    } else {
      const catLabel =
        activeCat === "all" ? "全部" :
        activeCat === "join" ? "参加・初心者" :
        activeCat === "session" ? "卓・セッション" :
        activeCat === "tools" ? "ツール" :
        activeCat === "rules" ? "ルール" :
        activeCat === "trouble" ? "トラブル" :
        activeCat === "other" ? "その他" : activeCat;

      hit.textContent = `表示中：${catLabel} / ヒット：${visibleItems}件`;
    }
  };

  // フィルタ
  filters.addEventListener("click", (e) => {
    const btn = e.target.closest(".qa-filter");
    if (!btn) return;

    filters.querySelectorAll(".qa-filter").forEach(b => b.classList.remove("is-active"));
    btn.classList.add("is-active");

    activeCat = btn.dataset.filter || "all";
    apply();
  });

  // 検索
  search.addEventListener("input", apply);

  // 全部開く/閉じる（表示中だけ対象）
  btnOpenAll.addEventListener("click", () => {
    items.forEach(d => {
      if (d.style.display !== "none") d.open = true;
    });
  });
  btnCloseAll.addEventListener("click", () => {
    items.forEach(d => {
      if (d.style.display !== "none") d.open = false;
    });
  });

  // クリア
  btnClear.addEventListener("click", () => {
    search.value = "";
    activeCat = "all";
    filters.querySelectorAll(".qa-filter").forEach(b => b.classList.remove("is-active"));
    filters.querySelector('[data-filter="all"]').classList.add("is-active");
    apply();
    search.focus();
  });

  // 初期適用
  apply();
})();
</script>

</body>
</html>